# Installation and Usage Instructions
Import and export hdf5 files from Igor. Import these hdf5 files to Python.
# hdf5.IO
Import and export hdf5 files from Igor. Import files to Python.

Dependencies: SARFIA (Igor procedures), ScanMLoader (Igor procedures), HDF5 XOP (Igor extension), h5py (Python Module)
Dependencies: SARFIA (essential), HDF5 XOP (essential, see below), ScanM IO (recommended).

## Installing HDF5 XOP
1) In your wavemetrics folder in My Documents, make a shortcut to the HDF5 Browser in your Igor Procedures folder
-- This file is located in WaveMetrics Procedures\File Input Output\HDF5 Browser.ipf in your Igor Pro installation directory
2) Make a shortcut to the HDF5 extension in your Igor Extensions folder
-- This file is located in \More Extensions\File Loaders\HDF5.xop in your Igor Pro installation directory
Ensure that:
'constant        SCMIO_addCFDNote            = 1'
... is set correctly in the ScM script, or errors will be triggered.

Call all functions via `"OS_GUI()"`

The following waves are exported from Igor and imported to Python:

OS_Parameters (1D with labels) - Likely to change in future

ROIs (2D wave)

Traces0_raw // 2D

Traces0_znorm // 2D

Tracetimes0 // 2D in seconds

Triggertimes // 1D in seconds

Triggervalue // 1D

Other waves that may be of interest:

RoisSizes//1D

Stack_SD //2D

wDataCh0_detrended // (raw data detrended) (3D)

Note: Python does not currently export labels from OS_Parameters

Prerequistites:

1) HDF5 Loader initiated (make shortcut from ...Wavemetrics.../More Extensions/File Loaders/HDF5 and stick that shortcut into Igor Extensions)
2) SARFIA needs to be installed
3) ScanMLoader installed, in 64 bit config without Trigger channel merging option

- Now take all "OS" scripts and dump them inside User Procedures (subfolder is fine)
- Go to "Igor Procedures/Customstart.ipf" and add the following line:

## Installing OS scripts
1) Copy all "OS" scripts into your User Procedures in My Documents
2) Open "Igor Procedures/Customstart.ipf" and add the following line:
`#include "OS_GUI"`
3) Restart Igor for changes to take effect.

## Using OS scripts (Igor)
1) Run the function `"OS_GUI()"`. If you have followed the instructions listed above, this should open the GUI in Igor.
2) Execute OS functions by clicking sequentially through the buttons on the GUI
  i. `Load Parameter Table`: Creates table containing the parameters which control subsequent preprocessing scripts
  ii. ROI placement can be done with either `Manually` + `Apply` OR `Autom. by Correlation`
  iii. `Traces & Triggers` then extracts traces and triggers from the raw data
  iv. OPTIONAL: `Basic Averaging` performs some simple statics and plots the ROIs in Igor
  v. `Export for database` then exports files from your current data folder to the folder specified in the procedure.
    a. It is recommended that you modify the Export for database procedure before using it
    b. Open procedure OS_hdf5Export.ipf
    c. Modify targetPath to match the directory you would like to export the file to
    d. Modify the string at the end of the line `HDF5CreateFile` to the name of the file you export
    e. The waves after HDF5SaveData are then saved inside a HDF5 file at the specified directory
3) The following waves are exported:
  i. OS_Parameters: The parameters generated by the `Load Parameter Table` function
  ii. ROIs: The ROI mask used to extract the traces
  iii. Traces0_raw: The traces extracted using the ROI mask without normalisation
  iv. Traces0_znorm: Traces0_raw but with normalisation
  v. Tracestimes0: ??
  vi. Triggertimes: ??
  vii. Triggervalues: ??

## Using Import scripts (Python)
Python Module Dependencies: h5py, numpy, os, pandas, seaborn
Note: These scripts will work in both the iPython server and desktop GUIs, but the directory access will differ. See below.
1) Change the target directory to the location of the file e.g. os.chdir('>directoryName')
2) Execute the function importPreprocessedData. This will return two waves:
  i. importedData: The raw hdf5 data as it was imported into Python
  ii. preprocessedData: The data extracted from the hdf5 data, stored in a form usable in the Python environment
    a. OS_Parameters: Pandas DataFrame, with index labels corresponding to the labels in the original Igor Table
    b. ROIs: Numpy array
    c. Traces0_raw: Pandas DataFrame with indexs as `ROI###`
    d. Traces0_znorm: Pandas DataFrame with indexes as `ROI###`
    e. Tracestimes0: Numpy array
    f. Triggertimes: Numpy array
    g. Triggervalues: Numpy array

Numpy arrays can be used much like matrices in MATLAB.
DataFrame objects are very similiar to arrays, but are structured as tables with column and row labels.
-- For Pandas documentation, see: http://pandas.pydata.org/
